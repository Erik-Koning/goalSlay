/* Warp Tunnel 3D Effect - Tunable via CSS variables */

.warp-scene {
  display: inline-block;
  vertical-align: middle;
  perspective: var(--warp-perspective, 5px);
  perspective-origin: 50% 50%;
  position: relative;
  /* Base transforms always applied */
  filter: hue-rotate(var(--warp-base-hue-rotate, 0deg));
  transform: scaleX(var(--warp-base-scale-x, 1))
             rotateX(var(--warp-base-rotate-x, 0deg))
             rotateY(var(--warp-base-rotate-y, 0deg))
             rotateZ(var(--warp-base-rotate-z, 0deg));
  /* Base rotation animation - only runs if rate > 0 */
  animation: warp-base-spin calc(360s / max(var(--warp-base-rotate-rate-z, 0.001), 0.001)) linear infinite;
}

@keyframes warp-base-spin {
  from {
    transform: scaleX(var(--warp-base-scale-x, 1))
               rotateX(var(--warp-base-rotate-x, 0deg))
               rotateY(var(--warp-base-rotate-y, 0deg))
               rotateZ(var(--warp-base-rotate-z, 0deg));
  }
  to {
    transform: scaleX(var(--warp-base-scale-x, 1))
               rotateX(var(--warp-base-rotate-x, 0deg))
               rotateY(var(--warp-base-rotate-y, 0deg))
               rotateZ(calc(var(--warp-base-rotate-z, 0deg) + 360deg));
  }
}

.warp-wrap {
  position: absolute;
  width: var(--warp-size, 1000px);
  height: var(--warp-size, 1000px);
  left: calc(var(--warp-half-size, 500px) * -1);
  top: calc(var(--warp-half-size, 500px) * -1);
  transform-style: preserve-3d;
  animation: warp-move var(--warp-duration, 12s) infinite linear;
  animation-fill-mode: forwards;
}

.warp-wrap-delayed {
  animation: warp-move var(--warp-duration, 12s) infinite linear;
  animation-delay: var(--warp-delay, 6s);
}

.warp-wall {
  width: 100%;
  height: 100%;
  position: absolute;
  opacity: 0;
  animation: warp-fade var(--warp-duration, 12s) infinite linear;
  animation-delay: 0;
  /* Fallback gradient when no inline background style is set */
  background:
    radial-gradient(ellipse at center, transparent 0%, #000 100%),
    repeating-linear-gradient(
      0deg,
      transparent 0px,
      transparent 2px,
      rgba(255, 255, 255, 0.8) 2px,
      rgba(255, 255, 255, 0.8) 3px,
      transparent 3px,
      transparent 20px
    ),
    repeating-linear-gradient(
      90deg,
      transparent 0px,
      transparent 15px,
      rgba(96, 165, 250, 0.6) 15px,
      rgba(96, 165, 250, 0.6) 16px,
      transparent 16px,
      transparent 40px
    ),
    repeating-linear-gradient(
      45deg,
      transparent 0px,
      transparent 25px,
      rgba(74, 222, 128, 0.5) 25px,
      rgba(74, 222, 128, 0.5) 26px,
      transparent 26px,
      transparent 60px
    ),
    #000;
  background-size: cover;
}

.warp-wrap-delayed .warp-wall {
  animation-delay: var(--warp-delay, 6s);
}

.warp-wall-right {
  transform: rotateY(90deg) translateZ(var(--warp-half-size, 500px));
}

.warp-wall-left {
  transform: rotateY(-90deg) translateZ(var(--warp-half-size, 500px));
}

.warp-wall-top {
  transform: rotateX(90deg) translateZ(var(--warp-half-size, 500px));
}

.warp-wall-bottom {
  transform: rotateX(-90deg) translateZ(var(--warp-half-size, 500px));
}

.warp-wall-back {
  transform: rotateX(180deg) translateZ(var(--warp-half-size, 500px));
}

@keyframes warp-move {
  0% {
    transform: translateZ(calc(var(--warp-translate-z, 500px) * -1)) rotate(0deg);
  }
  100% {
    transform: translateZ(var(--warp-translate-z, 500px)) rotate(0deg);
  }
}

@keyframes warp-fade {
  0% {
    opacity: 0;
  }
  25% {
    opacity: 1;
  }
  75% {
    opacity: 1;
  }
  100% {
    opacity: 0;
  }
}

/* Secret psychedelic mode - infinite loop */
.warp-scene-psychedelic {
  animation: warp-psychedelic 300s infinite linear, warp-spin 1s linear infinite;
  animation-duration: 300s, calc(360s / max(var(--warp-rotate-rate-x, 1) + var(--warp-rotate-rate-y, 1) + var(--warp-rotate-rate-z, 1), 1));
}

@keyframes warp-psychedelic {
  0% {
    filter: hue-rotate(var(--warp-base-hue-rotate, 0deg));
    transform: scaleX(var(--warp-base-scale-x, 1))
               rotateX(var(--warp-base-rotate-x, 0deg))
               rotateY(var(--warp-base-rotate-y, 0deg))
               rotateZ(var(--warp-base-rotate-z, 0deg));
  }
  50% {
    filter: hue-rotate(calc(var(--warp-base-hue-rotate, 0deg) + var(--warp-peak-hue-rotate, 50deg))) saturate(1);
    transform: scaleX(calc(var(--warp-base-scale-x, 1) * var(--warp-peak-scale-x, 2000)))
               rotateX(calc(var(--warp-base-rotate-x, 0deg) + var(--warp-peak-rotate-x, 0deg)))
               rotateY(calc(var(--warp-base-rotate-y, 0deg) + var(--warp-peak-rotate-y, 0deg)))
               rotateZ(calc(var(--warp-base-rotate-z, 0deg) + var(--warp-peak-rotate-z, 0deg)));
    perspective: 50px;
  }
  100% {
    filter: hue-rotate(calc(var(--warp-base-hue-rotate, 0deg) - var(--warp-peak-hue-rotate, 50deg)));
    transform: scaleX(var(--warp-base-scale-x, 1))
               rotateX(var(--warp-base-rotate-x, 0deg))
               rotateY(var(--warp-base-rotate-y, 0deg))
               rotateZ(var(--warp-base-rotate-z, 0deg));
  }
}

/* Continuous rotation based on rate */
@keyframes warp-spin {
  0% {
    transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg);
  }
  100% {
    transform: rotateX(var(--warp-rotate-rate-x, 0deg))
               rotateY(var(--warp-rotate-rate-y, 0deg))
               rotateZ(var(--warp-rotate-rate-z, 0deg));
  }
}

/* Psychedelic burst mode - peaks at halfway, smoothly reverts to normal */
.warp-scene-psychedelic-burst {
  animation: warp-psychedelic-burst var(--warp-duration, 12s) ease-in-out forwards;
}

@keyframes warp-psychedelic-burst {
  0% {
    filter: hue-rotate(var(--warp-base-hue-rotate, 0deg)) saturate(1);
    transform: scaleX(var(--warp-base-scale-x, 1))
               rotateX(var(--warp-base-rotate-x, 0deg))
               rotateY(var(--warp-base-rotate-y, 0deg))
               rotateZ(var(--warp-base-rotate-z, 0deg));
    perspective: var(--warp-perspective, 5px);
  }
  50% {
    filter: hue-rotate(calc(var(--warp-base-hue-rotate, 0deg) + var(--warp-peak-hue-rotate, 50deg))) saturate(5);
    transform: scaleX(calc(var(--warp-base-scale-x, 1) * var(--warp-peak-scale-x, 100)))
               rotateX(calc(var(--warp-base-rotate-x, 0deg) + var(--warp-peak-rotate-x, 0deg)))
               rotateY(calc(var(--warp-base-rotate-y, 0deg) + var(--warp-peak-rotate-y, 0deg)))
               rotateZ(calc(var(--warp-base-rotate-z, 0deg) + var(--warp-peak-rotate-z, 0deg)));
    perspective: 50px;
  }
  100% {
    filter: hue-rotate(var(--warp-base-hue-rotate, 0deg)) saturate(1);
    transform: scaleX(var(--warp-base-scale-x, 1))
               rotateX(var(--warp-base-rotate-x, 0deg))
               rotateY(var(--warp-base-rotate-y, 0deg))
               rotateZ(var(--warp-base-rotate-z, 0deg));
    perspective: var(--warp-perspective, 5px);
  }
}
